<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hands-On Practice: S3 Gateway Endpoints | Kevin Liu's Blog || Technical || Travel</title><meta name="author" content="Kevin Liu"><meta name="copyright" content="Kevin Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="What is S3 Gateway Endpoints? Let‚Äôs consider a scenario  How could your Lambda function access the content in the S3 bucket?  If you want a service to access the content in the S3 bucket, it usually g">
<meta property="og:type" content="article">
<meta property="og:title" content="Hands-On Practice: S3 Gateway Endpoints">
<meta property="og:url" content="https://leozzmc.github.io/en/posts/e7e295f6.html">
<meta property="og:site_name" content="Kevin Liu&#39;s Blog || Technical || Travel">
<meta property="og:description" content="What is S3 Gateway Endpoints? Let‚Äôs consider a scenario  How could your Lambda function access the content in the S3 bucket?  If you want a service to access the content in the S3 bucket, it usually g">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://leozzmc.github.io/en/img/pepe4.jpeg">
<meta property="article:published_time" content="2023-10-23T04:32:05.000Z">
<meta property="article:modified_time" content="2024-01-20T06:59:29.813Z">
<meta property="article:author" content="Kevin Liu">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="S3">
<meta property="article:tag" content="Endpoints">
<meta property="article:tag" content="Gateway">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://leozzmc.github.io/en/img/pepe4.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Hands-On Practice: S3 Gateway Endpoints",
  "url": "https://leozzmc.github.io/en/posts/e7e295f6.html",
  "image": "https://leozzmc.github.io/en/img/pepe4.jpeg",
  "datePublished": "2023-10-23T04:32:05.000Z",
  "dateModified": "2024-01-20T06:59:29.813Z",
  "author": [
    {
      "@type": "Person",
      "name": "Kevin Liu",
      "url": "https://leozzmc.github.io/en"
    }
  ]
}</script><link rel="shortcut icon" href="/en/img/kevin3.png"><link rel="canonical" href="https://leozzmc.github.io/en/posts/e7e295f6.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/en/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-T4SFRRLLZ0"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-T4SFRRLLZ0')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-T4SFRRLLZ0', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/en/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"ÁπÅ","msgToSimplifiedChinese":"Á∞°"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hands-On Practice: S3 Gateway Endpoints',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/en/css/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg" style="background-color: #f5f1ed;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/en/img/me.jpg" onerror="this.onerror=null;this.src='/en/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Find Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Languages:</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/"><i class="fa-fw fas fa-e"></i><span> English</span></a></li><li><a class="site-page child" href="https://leozzmc.github.io/"><i class="fa-fw fas fa-c"></i><span> ‰∏≠Êñá</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/en/img/pepe4.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/en/"><img class="site-icon" src="https://i.imgur.com/P19VCm0.png" alt="Logo"><span class="site-name">Kevin Liu's Blog || Technical || Travel</span></a><a class="nav-page-title" href="/en/"><span class="site-name">Hands-On Practice: S3 Gateway Endpoints</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Find Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Languages:</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/"><i class="fa-fw fas fa-e"></i><span> English</span></a></li><li><a class="site-page child" href="https://leozzmc.github.io/"><i class="fa-fw fas fa-c"></i><span> ‰∏≠Êñá</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Hands-On Practice: S3 Gateway Endpoints</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-10-23T04:32:05.000Z" title="Created 2023-10-23 12:32:05">2023-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-01-20T06:59:29.813Z" title="Updated 2024-01-20 14:59:29">2024-01-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/en/categories/Hands-On-Practices/">Hands-On Practices</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="What-is-S3-Gateway-Endpoints"><a href="#What-is-S3-Gateway-Endpoints" class="headerlink" title="What is S3 Gateway Endpoints?"></a>What is S3 Gateway Endpoints?</h1><p><img src="https://i.imgur.com/MUsKNi4.png" alt="Imgur"></p>
<p>Let‚Äôs consider a scenario</p>
<blockquote>
<p>How could your Lambda function access the content in the S3 bucket?</p>
</blockquote>
<p>If you want a service to access the content in the S3 bucket, it usually go through VPC endpoint. S3 supports two types of VPC endpoint,each of which is <strong>Gateway endpoint</strong> and <strong>Interface endpoint</strong></p>
<!--Â¶ÇÊûúË¶ÅÈÄöÈÅé‰∏ÄÂÄãÊúçÂãô‰æÜÂ≠òÂèñ S3 Áï∂‰∏≠ÁöÑÂÖßÂÆπÔºåÈÄöÂ∏∏ÊòØÊúÉÈÄöÈÅé VPC EndpointÔºåËÄåÂú® S3 Áï∂‰∏≠ÂèàÊîØÊè¥ÂÖ©Á®Æ‰∏çÂêåÁöÑ VPC EndpointÈ°ûÂûãÔºåÂàÜÂà•ÊòØ **Gateway Endpoint** ‰ª•Âèä **Interface Endpoint**-->

<p>The diffeences between two types of VPC endpoints are listed below</p>
<table>
<thead>
<tr>
<th>S3 Gateway Endpoints</th>
<th>S3 Interface Endpoints</th>
</tr>
</thead>
<tbody><tr>
<td>Use S3 Public IP Address</td>
<td>Use Private IP Address in VPC to access S3</td>
</tr>
<tr>
<td>Use the same S3 DNS Name</td>
<td>Name must include VPC Endpoint ID [3]</td>
</tr>
<tr>
<td>cannot access internally</td>
<td>can access internally</td>
</tr>
<tr>
<td>cannot access from other AWS region</td>
<td>can access from other AWS region by using VPC peering or AWS Transit gateway</td>
</tr>
<tr>
<td>Free</td>
<td>In chrarge</td>
</tr>
</tbody></table>
<!-- >> **ÊâÄ‰ª•Áï∂‰Ω†ÁöÑÊÉÖÂ¢ÉÊòØ‰Ω†Âú®ÂêåÂÄã Region Â∫ï‰∏ãÊúâÂÄã Lambda ÂáΩÊï∏ÊÉ≥Ë¶ÅÂ≠òÂèñ S3 ÁöÑÂÖßÂÆπÔºåÈÇ£Â∞±ÂæàÈÅ©Âêà‰ΩøÁî® Gateway Endpoint** -->

<blockquote>
<p>So if your scenario is that a Lambda function want to access the content in S3 bucket in the same region, it is great to utilize the Gateway Endpoint</p>
</blockquote>
<h2 id="Consideration-of-S3-Gateway-Endpoint"><a href="#Consideration-of-S3-Gateway-Endpoint" class="headerlink" title="Consideration of S3 Gateway Endpoint"></a>Consideration of S3 Gateway Endpoint</h2><p>It is worth to mestion that there are several things you need to consider before choosing S3 Gateway Endpoints, make sure you go through the section in the official documentation</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html#gateway-endpoint-considerations-s3">https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html#gateway-endpoint-considerations-s3</a></p>
</blockquote>
<h2 id="Private-DNS"><a href="#Private-DNS" class="headerlink" title="Private DNS"></a>Private DNS</h2><p>When you are trying yo create Gateway Endpoint or Interface Endpoint for your S3, you can decide creating private DNS for cost down.</p>
<blockquote>
<p>This is implement by Route53 Resolver<br>For detail you can checkÔºö<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/Route53/latest/DeveloperGuide/resolver.html">https://docs.aws.amazon.com/zh_tw/Route53/latest/DeveloperGuide/resolver.html</a></p>
</blockquote>
<h1 id="Steps-for-building-Gateway-Endpoint"><a href="#Steps-for-building-Gateway-Endpoint" class="headerlink" title="Steps for building Gateway Endpoint"></a><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/vpc/latest/privatelink/vpc-endpoints-s3.html#create-gateway-endpoint-s3">Steps for building Gateway Endpoint</a></h1><ul>
<li>Go to AWS Console to create the endpoint</li>
</ul>
<blockquote>
<p>VPC &#x2F; Endpoints &#x2F; Create Endpoint</p>
</blockquote>
<p><img src="https://i.imgur.com/asOslk6.png" alt="Imgur"></p>
<ul>
<li>Choose <code>AWS services</code> , and <code>com.amaazonaws.us-east-1.s3</code></li>
</ul>
<p><img src="https://i.imgur.com/ujgXmUq.png" alt="Imgur"></p>
<ul>
<li>Then, press create endpoints</li>
</ul>
<h2 id="Associate-Route-Table"><a href="#Associate-Route-Table" class="headerlink" title="Associate Route Table"></a>Associate Route Table</h2><ul>
<li>Make sure the route table that assoicate to the gateway endpoint is clean.<blockquote>
<p>If you don‚Äôt have on, then make one.</p>
</blockquote>
</li>
</ul>
<p><img src="https://i.imgur.com/cI4mrOt.png" alt="Imgur"></p>
<h2 id="Configure-policy"><a href="#Configure-policy" class="headerlink" title="Configure policy"></a>Configure policy</h2><ul>
<li>For testing purposes, I choose <code>Full Access</code></li>
</ul>
<p><img src="https://i.imgur.com/kiQtSej.png" alt="Imgur"></p>
<ul>
<li>Then, press create endpoint</li>
</ul>
<h2 id="Check-the-routing"><a href="#Check-the-routing" class="headerlink" title="Check the routing"></a>Check the routing</h2><p>After establishing the endpoint, you can check if the default route of route table is well configured</p>
<p><img src="https://i.imgur.com/3Ajfl91.png" alt="Imgur"></p>
<p>Next, we must configure a Lambda function for accessing S3 bucket.</p>
<h2 id="Configure-Lambda-Function"><a href="#Configure-Lambda-Function" class="headerlink" title="Configure Lambda Function"></a>Configure Lambda Function</h2><p>If you put a Lambda funciton into a VPC, it will attach to 2 subnets by defaults.</p>
<p>Make sure two subnet have default route to S3 Gateway Endpoints.</p>
<p><img src="https://i.imgur.com/XmbfUKe.png" alt="Imgur"><br><img src="https://i.imgur.com/AP6fZGy.png" alt="Imgur"></p>
<ul>
<li>Create Lambda function, and enable the VPC</li>
</ul>
<p><img src="https://i.imgur.com/eBfWExA.png" alt="Imgur"></p>
<ul>
<li>Lambda Code</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lambda_handler</span>(<span class="params">event, context</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;CREATE CLIENT&quot;</span>)</span><br><span class="line">    s3 = boto3.client(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;START REQUEST&quot;</span>)</span><br><span class="line">    resp = s3.list_objects(Bucket=<span class="string">&quot;testbucket4-s3gateway-endpoint&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(resp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;statusCode&#x27;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&#x27;body&#x27;</span>: json.dumps(<span class="string">&#x27;Hello from Lambda!&#x27;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>In this Lambda code, Lambda will try to list the objects in the bucket, can print out the information of  response object in the log.</p>
<ul>
<li>Configure policy of Lambda execution role</li>
</ul>
<p>I simply attach AWS Managed Policy <code>AmazonS3FullAccess</code> to the execution role for testing</p>
<blockquote>
<p>Notice, you should not give full access to your Lambda function in production mode, make sure giving adequient permssion to the role.</p>
</blockquote>
<p><img src="https://i.imgur.com/U3mPX0h.png" alt="Imgur"></p>
<h2 id="Check-invocations"><a href="#Check-invocations" class="headerlink" title="Check invocations"></a>Check invocations</h2><ul>
<li>Press <code>test</code> button in the Lambda console, you‚Äôll noticee the lambda get invoked successfully</li>
</ul>
<p><img src="https://i.imgur.com/WB3iyyD.png" alt="Imgur"></p>
<ul>
<li>Then you need to check the invocation logs in CloudWatch</li>
</ul>
<p><img src="https://i.imgur.com/j5q8yCp.png" alt="Imgur"></p>
<p>You can see that the object information were listed and printed out in the invocation logs.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/vpc/latest/privatelink/vpc-endpoints-s3.html#create-gateway-endpoint-s3">https://docs.aws.amazon.com/zh_tw/vpc/latest/privatelink/vpc-endpoints-s3.html#create-gateway-endpoint-s3</a><br>[2] <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/AmazonS3/latest/userguide/privatelink-interface-endpoints.html#types-of-vpc-endpoints-for-s3">https://docs.aws.amazon.com/zh_tw/AmazonS3/latest/userguide/privatelink-interface-endpoints.html#types-of-vpc-endpoints-for-s3</a><br>[3] <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/AmazonS3/latest/userguide/privatelink-interface-endpoints.html#accessing-s3-interface-endpoints">https://docs.aws.amazon.com/zh_tw/AmazonS3/latest/userguide/privatelink-interface-endpoints.html#accessing-s3-interface-endpoints</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://leozzmc.github.io/en">Kevin Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://leozzmc.github.io/en/posts/e7e295f6.html">https://leozzmc.github.io/en/posts/e7e295f6.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/en/tags/AWS/">AWS</a><a class="post-meta__tags" href="/en/tags/S3/">S3</a><a class="post-meta__tags" href="/en/tags/Endpoints/">Endpoints</a><a class="post-meta__tags" href="/en/tags/Gateway/">Gateway</a></div><div class="post-share"><div class="social-share" data-image="/en/img/pepe4.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/en/posts/Buffer_Overflow_Test.html" title="Buffer Overflow Vulnerability Experiment"><img class="cover" src="/en/img/BOF.png" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Buffer Overflow Vulnerability Experiment</div></div><div class="info-2"><div class="info-item-1">IntroductionBuffer Overflow Vulnerability is one of the most common and severe security vulnerabilities in the field of software and system security. In the complex software systems of today‚Äôs digital age, the threat from hackers or malicious users is ever-present. Buffer Overflow Vulnerability is one of the most concerning threats among them due to the significant threat it poses to computer s...</div></div></div></a><a class="pagination-related" href="/en/posts/efc78ef4.html" title="Hands-On Practice: Amazon SNS Fan out to Amazon SQS"><img class="cover" src="/en/img/pepe5.jpeg" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Hands-On Practice: Amazon SNS Fan out to Amazon SQS</div></div><div class="info-2"><div class="info-item-1">IntroductionAmazon SNS offen works well with Amazon SQS, by subscribing SQS to SNS, the SNS service can push messages to SQS. This may eliminating the need to periodically check or ‚Äúpoll‚Äù for updates. What is Amazon SQS?By official definition  Amazon SQS is a message queue service used by distributed applications to exchange messages through a polling model, and can be used to decouple sending ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/en/posts/752506ab.html" title="Linux Process Deep Dive-1: Knowledge of PID 0 "><img class="cover" src="/en/img/PID0.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-14</div><div class="info-item-2">Linux Process Deep Dive-1: Knowledge of PID 0 </div></div><div class="info-2"><div class="info-item-1">PID 0 An Idle Process used to swap all pages of processs to&#x2F;from memory&#x2F;backing store. ‚ÄúSwap Process‚Äù It was there, so Linux always have CPU to execute something If you try to execute ps command on the clean Ubuntu Linux, you‚Äôll find there was no process with ‚ÄúPID0‚Äù  Idle systemcall not supported since kernal 2.3.13   Then how can we prove that PID0 really exist?  Demo Using bpftrace ...</div></div></div></a><a class="pagination-related" href="/en/posts/aws_iot_jobs.html" title="Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial"><img class="cover" src="/en/img/aws_iot_job.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-20</div><div class="info-item-2">Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial</div></div><div class="info-2"><div class="info-item-1">What is a Job? A Job is a remote operation that is sent to and executed on one or more devices connected to AWS IoT. For example, you can define a Job that instructs a set of devices to download and install application or firmware updates, reboot, rotate certificates, or perform remote troubleshooting operations.  How to create a Job?You must create a job document first.  The Job Document is a ...</div></div></div></a><a class="pagination-related" href="/en/posts/aws-iot-device-shadow.html" title="Hands-On Practice: AWS IoT Device Shadow"><img class="cover" src="/en/img/pepe_shadow.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-08</div><div class="info-item-2">Hands-On Practice: AWS IoT Device Shadow</div></div><div class="info-2"><div class="info-item-1">Intro - What is AWS IoT Device Shadow?In real world, sometime it is difficult to get the actual device state in real time in such IoT scenarios. A device shadow can overcome this challenge, Device Shadow can consider a virtual  virtual representation of a device which managed by the IoT Things resource created in AWS IoT Core.  The Shadow document is a JSON or a JavaScript notation doc that is ...</div></div></div></a><a class="pagination-related" href="/en/posts/8d39dbf8.html" title="FreeRTOS_Note"><img class="cover" src="/en/img/freertos/pepe.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-02</div><div class="info-item-2">FreeRTOS_Note</div></div><div class="info-2"><div class="info-item-1">AWS FreeRTOS FreeRTOS includes libraries for connectivity, security, and over-the-air (OTA) updates. FreeRTOS also includes demo applications that show FreeRTOS features on qualified boards.   FreeRTOS is an open-source project. You can download the source code, contribute changes or enhancements, or report issues on the GitHub site at https://github.com/FreeRTOS/FreeRTOS.  FreeRTOS - Architect...</div></div></div></a><a class="pagination-related" href="/en/posts/889a40ef.html" title="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance"><img class="cover" src="/en/img/OIG.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-09</div><div class="info-item-2">Fleet Provisioning - Provisioning Devices to AWS IoT in Advance</div></div><div class="info-2"><div class="info-item-1">IntroductionWhat is Fleet Provisioning?Fleet Provisioning can be divided into Provisioning by Claim and Provisioning by Trusted User. Provisioning by ClaimDevices can use embedded provisioning claim certificates (special-purpose certificates) and private keys for manufacturing. If these certificates are registered with AWS IoT, the service can exchange them for a unique device certificate that ...</div></div></div></a><a class="pagination-related" href="/en/posts/efc78ef4.html" title="Hands-On Practice: Amazon SNS Fan out to Amazon SQS"><img class="cover" src="/en/img/pepe5.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="info-item-2">Hands-On Practice: Amazon SNS Fan out to Amazon SQS</div></div><div class="info-2"><div class="info-item-1">IntroductionAmazon SNS offen works well with Amazon SQS, by subscribing SQS to SNS, the SNS service can push messages to SQS. This may eliminating the need to periodically check or ‚Äúpoll‚Äù for updates. What is Amazon SQS?By official definition  Amazon SQS is a message queue service used by distributed applications to exchange messages through a polling model, and can be used to decouple sending ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/en/img/me.jpg" onerror="this.onerror=null;this.src='/en/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Kevin Liu</div><div class="author-info-description">üëçüëçüëçüëçüëç</div><div class="site-data"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/leozzmc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/leozzmc" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:zzmczzmczzmc870125@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #e0ad5a;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/kevin-liu087" target="_blank" title="LinkedIn"><i class="fa-brands fa-linkedin" style="color: #0373fc;"></i></a><a class="social-icon" href="https://www.youtube.com/channel/UC2AU_vpxPu0oKcgZl3UJSNg" target="_blank" title="Youtube"><i class="fa-brands fa-youtube" style="color: #dc1e1e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">üõ´üõ¨</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#What-is-S3-Gateway-Endpoints"><span class="toc-number">1.</span> <span class="toc-text">What is S3 Gateway Endpoints?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Consideration-of-S3-Gateway-Endpoint"><span class="toc-number">1.1.</span> <span class="toc-text">Consideration of S3 Gateway Endpoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Private-DNS"><span class="toc-number">1.2.</span> <span class="toc-text">Private DNS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Steps-for-building-Gateway-Endpoint"><span class="toc-number">2.</span> <span class="toc-text">Steps for building Gateway Endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Associate-Route-Table"><span class="toc-number">2.1.</span> <span class="toc-text">Associate Route Table</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure-policy"><span class="toc-number">2.2.</span> <span class="toc-text">Configure policy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Check-the-routing"><span class="toc-number">2.3.</span> <span class="toc-text">Check the routing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure-Lambda-Function"><span class="toc-number">2.4.</span> <span class="toc-text">Configure Lambda Function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Check-invocations"><span class="toc-number">2.5.</span> <span class="toc-text">Check invocations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">2.6.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/en/posts/aws_iot_jobs.html" title="Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial"><img src="/en/img/aws_iot_job.png" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial"/></a><div class="content"><a class="title" href="/en/posts/aws_iot_jobs.html" title="Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial">Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial</a><time datetime="2024-01-20T07:04:16.000Z" title="Created 2024-01-20 15:04:16">2024-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/752506ab.html" title="Linux Process Deep Dive-1: Knowledge of PID 0 "><img src="/en/img/PID0.jpeg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Linux Process Deep Dive-1: Knowledge of PID 0 "/></a><div class="content"><a class="title" href="/en/posts/752506ab.html" title="Linux Process Deep Dive-1: Knowledge of PID 0 ">Linux Process Deep Dive-1: Knowledge of PID 0 </a><time datetime="2023-12-13T23:01:50.000Z" title="Created 2023-12-14 07:01:50">2023-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/8d39dbf8.html" title="FreeRTOS_Note"><img src="/en/img/freertos/pepe.jpg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="FreeRTOS_Note"/></a><div class="content"><a class="title" href="/en/posts/8d39dbf8.html" title="FreeRTOS_Note">FreeRTOS_Note</a><time datetime="2023-12-02T07:50:49.000Z" title="Created 2023-12-02 15:50:49">2023-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/889a40ef.html" title="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance"><img src="/en/img/OIG.jpeg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance"/></a><div class="content"><a class="title" href="/en/posts/889a40ef.html" title="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance">Fleet Provisioning - Provisioning Devices to AWS IoT in Advance</a><time datetime="2023-11-09T07:14:35.000Z" title="Created 2023-11-09 15:14:35">2023-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/aws-iot-device-shadow.html" title="Hands-On Practice: AWS IoT Device Shadow"><img src="/en/img/pepe_shadow.jpg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Hands-On Practice: AWS IoT Device Shadow"/></a><div class="content"><a class="title" href="/en/posts/aws-iot-device-shadow.html" title="Hands-On Practice: AWS IoT Device Shadow">Hands-On Practice: AWS IoT Device Shadow</a><time datetime="2023-11-08T08:30:18.000Z" title="Created 2023-11-08 16:30:18">2023-11-08</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2025 By Kevin Liu</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">ÁπÅ</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/en/js/utils.js"></script><script src="/en/js/main.js"></script><script src="/en/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'dark'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null
  const getUtterancesTheme = theme => theme === 'dark' ? 'photon-dark' : 'github-light'

  const loadUtterances = (el = document, key) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyUtterances = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const config = {
      src: 'https://utteranc.es/client.js',
      repo: 'leozzmc/Blog_Reply',
      theme: getUtterancesTheme(document.documentElement.getAttribute('data-theme')),
      crossorigin: 'anonymous',
      async: true,
      ...option,
      'issue-term': isShuoshuo ? key : (option && option['issue-term']) || 'pathname'
    }

    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => ele.setAttribute(key, value))
    el.querySelector('#utterances-wrap').appendChild(ele)
  }

  const changeUtterancesTheme = theme => {
    const iframe = document.querySelector('#utterances-wrap iframe')
    if (iframe) {
      const message = {
        type: 'set-theme',
        theme: getUtterancesTheme(theme)
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es')
    }
  }

  btf.addGlobalFn('themeChange', changeUtterancesTheme, 'utterances')

  if (isShuoshuo) {
    'Utterances' === 'Utterances'
      ? window.shuoshuoComment = { loadComment: loadUtterances }
      : window.loadOtherComment = loadUtterances
    return
  }
  
  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><script data-pjax src="/en/self/btf.js"></script><script data-pjax src="/en/self/tw_en.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script data-pjax src="/self/calendar.js"></script><script data-pjax src="/self/languages.js"></script><script id="canvas_nest" defer="defer" color="34,34,34" opacity="0.8" zIndex="-1" count="350" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>