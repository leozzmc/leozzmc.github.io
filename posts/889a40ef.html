<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Fleet Provisioning - Provisioning Devices to AWS IoT in Advance | Kevin Liu's Blog || Technical || Travel</title><meta name="author" content="Kevin Liu"><meta name="copyright" content="Kevin Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="IntroductionWhat is Fleet Provisioning?Fleet Provisioning can be divided into Provisioning by Claim and Provisioning by Trusted User. Provisioning by ClaimDevices can use embedded provisioning claim c">
<meta property="og:type" content="article">
<meta property="og:title" content="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance">
<meta property="og:url" content="https://leozzmc.github.io/en/posts/889a40ef.html">
<meta property="og:site_name" content="Kevin Liu&#39;s Blog || Technical || Travel">
<meta property="og:description" content="IntroductionWhat is Fleet Provisioning?Fleet Provisioning can be divided into Provisioning by Claim and Provisioning by Trusted User. Provisioning by ClaimDevices can use embedded provisioning claim c">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://leozzmc.github.io/en/img/OIG.jpeg">
<meta property="article:published_time" content="2023-11-09T07:14:35.000Z">
<meta property="article:modified_time" content="2025-10-26T12:28:30.381Z">
<meta property="article:author" content="Kevin Liu">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="IoT Core">
<meta property="article:tag" content="Device Provisioning">
<meta property="article:tag" content="Certificate">
<meta property="article:tag" content="Policy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://leozzmc.github.io/en/img/OIG.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Fleet Provisioning - Provisioning Devices to AWS IoT in Advance",
  "url": "https://leozzmc.github.io/en/posts/889a40ef.html",
  "image": "https://leozzmc.github.io/en/img/OIG.jpeg",
  "datePublished": "2023-11-09T07:14:35.000Z",
  "dateModified": "2025-10-26T12:28:30.381Z",
  "author": [
    {
      "@type": "Person",
      "name": "Kevin Liu",
      "url": "https://leozzmc.github.io/en"
    }
  ]
}</script><link rel="shortcut icon" href="/en/img/kevin3.png"><link rel="canonical" href="https://leozzmc.github.io/en/posts/889a40ef.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/en/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-T4SFRRLLZ0"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-T4SFRRLLZ0')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-T4SFRRLLZ0', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/en/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Fleet Provisioning - Provisioning Devices to AWS IoT in Advance',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/en/css/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg" style="background-color: #f5f1ed;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/en/img/me.jpg" onerror="this.onerror=null;this.src='/en/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Find Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Languages:</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/"><i class="fa-fw fas fa-e"></i><span> English</span></a></li><li><a class="site-page child" href="https://leozzmc.github.io/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/en/img/OIG.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/en/"><img class="site-icon" src="https://i.imgur.com/P19VCm0.png" alt="Logo"><span class="site-name">Kevin Liu's Blog || Technical || Travel</span></a><a class="nav-page-title" href="/en/"><span class="site-name">Fleet Provisioning - Provisioning Devices to AWS IoT in Advance</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Find Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Languages:</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/en/"><i class="fa-fw fas fa-e"></i><span> English</span></a></li><li><a class="site-page child" href="https://leozzmc.github.io/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Fleet Provisioning - Provisioning Devices to AWS IoT in Advance</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-11-09T07:14:35.000Z" title="Created 2023-11-09 15:14:35">2023-11-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-26T12:28:30.381Z" title="Updated 2025-10-26 20:28:30">2025-10-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/en/categories/Hands-On-Practices/">Hands-On Practices</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="What-is-Fleet-Provisioning"><a href="#What-is-Fleet-Provisioning" class="headerlink" title="What is Fleet Provisioning?"></a>What is Fleet Provisioning?</h2><p>Fleet Provisioning can be divided into <strong>Provisioning by Claim</strong> and <strong>Provisioning by Trusted User</strong>.</p>
<h3 id="Provisioning-by-Claim"><a href="#Provisioning-by-Claim" class="headerlink" title="Provisioning by Claim"></a>Provisioning by Claim</h3><p>Devices can use embedded provisioning claim certificates (special-purpose certificates) and private keys for manufacturing. If these certificates are registered with AWS IoT, the service can exchange them for a unique device certificate that the device can use for general operations.</p>
<h3 id="Provisioning-by-Trusted-User"><a href="#Provisioning-by-Trusted-User" class="headerlink" title="Provisioning by Trusted User"></a>Provisioning by Trusted User</h3><p>In many cases, when trusted users such as end-users or installation technicians set up devices at their deployment locations using a mobile application for the first time, the devices connect to AWS IoT.</p>
<blockquote>
<p><strong>This article mainly focuses on the Provisioning by Claim method for fleet provisioning</strong>.</p>
</blockquote>
<h2 id="Provisioning-by-Claim-Process"><a href="#Provisioning-by-Claim-Process" class="headerlink" title="Provisioning by Claim Process"></a>Provisioning by Claim Process</h2><p><img src="https://i.imgur.com/5UPLkKJ.png" alt="Imgur"></p>
<h2 id="Configuration-AWS-IoT-Core"><a href="#Configuration-AWS-IoT-Core" class="headerlink" title="Configuration - AWS IoT Core"></a>Configuration - AWS IoT Core</h2><h3 id="Create-Certificates-and-Public-x2F-Private-Key-Pairs"><a href="#Create-Certificates-and-Public-x2F-Private-Key-Pairs" class="headerlink" title="Create Certificates and Public&#x2F;Private Key Pairs"></a>Create Certificates and Public&#x2F;Private Key Pairs</h3><p>Generate certificates for provisioning</p>
<ul>
<li>You can do this on the AWS IoT Console under <strong>Secure</strong> &gt;&gt; <strong>Certificates</strong> &gt;&gt; <strong>Add Certificates</strong> &gt;&gt; <strong>Create Certificates</strong></li>
</ul>
<p><img src="https://i.imgur.com/ay2zm5V.png" alt="Imgur"><br><img src="https://i.imgur.com/Qnr2Olh.png" alt="Imgur"></p>
<ul>
<li>Next, a corresponding screen will appear, and you need to download the certificate and private key to your local machine. Additionally, for convenience, please download the Root CA certificate to your local machine.</li>
</ul>
<p><img src="https://i.imgur.com/kRUAGF9.png" alt="Imgur"></p>
<h3 id="Create-Provisioning-Template-and-Attach-Policy"><a href="#Create-Provisioning-Template-and-Attach-Policy" class="headerlink" title="Create Provisioning Template and Attach Policy"></a>Create Provisioning Template and Attach Policy</h3><ul>
<li>Create Provisioning Template</li>
</ul>
<p><img src="https://i.imgur.com/cG83JRG.png" alt="Imgur"></p>
<ul>
<li>Choose <strong>Provisioning devices with claim certificates</strong>, and then click <strong>Next</strong></li>
</ul>
<p><img src="https://i.imgur.com/7baFaol.png" alt="Imgur"></p>
<ul>
<li>Create an IoT service role by clicking <strong>Create Role</strong></li>
<li>After entering the Role Name, click <strong>View</strong></li>
</ul>
<p><img src="https://i.imgur.com/6bZNMWr.png" alt="Imgur"></p>
<ul>
<li>Attach policy</li>
<li>Search and attach the AWS managed policy <code>AWSIoTThingsRegistration</code></li>
</ul>
<p><img src="https://i.imgur.com/MwkIdA0.png" alt="Imgur"><br><img src="https://i.imgur.com/YW2Nfdh.png" alt="Imgur"></p>
<ul>
<li>Claim certificate policy, click <strong>Create IoT Policy</strong></li>
</ul>
<p><img src="https://i.imgur.com/21XORly.png" alt="Imgur"></p>
<ul>
<li>Enter the Policy Name and paste the sample JSON</li>
</ul>
<p><img src="https://i.imgur.com/mNKS8IC.png" alt="Imgur"></p>
<p>Sample IoT Policy</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;iot:Connect&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;iot:Publish&quot;</span><span class="punctuation">,</span><span class="string">&quot;iot:Receive&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;arn:aws:iot:aws-region:aws-account-id:topic/$aws/certificates/create/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;arn:aws:iot:aws-region:aws-account-id:topic/$aws/provisioning-templates/templateName/provision/*&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iot:Subscribe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;arn:aws:iot:aws-region:aws-account-id:topicfilter/$aws/certificates/create/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;arn:aws:iot:aws-region:aws-account-id:topicfilter/$aws/provisioning-templates/templateName/provision/*&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/Hzebj7r.png" alt="Imgur"></p>
<ul>
<li>Check the certificate<br><img src="https://i.imgur.com/5y8PAPu.png" alt="Imgur"></li>
</ul>
<p>Once completed, you can proceed to set up provisioning in advance.</p>
<h3 id="Configure-Pre-provisioning"><a href="#Configure-Pre-provisioning" class="headerlink" title="Configure Pre-provisioning"></a>Configure Pre-provisioning</h3><p>The template example for fleet provisioning can be found at:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/iot/latest/developerguide/provision-template.html#fleet-provisioning-example">https://docs.aws.amazon.com/iot/latest/developerguide/provision-template.html#fleet-provisioning-example</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Parameters&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;ThingName&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;String&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;SerialNumber&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;DeviceLocation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;LocationTable&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Seattle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;LocationUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.aws&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Resources&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;thing&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;AWS::IoT::Thing&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Properties&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;AttributePayload&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">                    <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;serialNumber&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;serialNumber&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;ThingName&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;Ref&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ThingName&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;ThingTypeName&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;Fn::Join&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="punctuation">[</span><span class="string">&quot;ThingPrefix_&quot;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Ref&quot;</span><span class="punctuation">:</span><span class="string">&quot;SerialNumber&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;ThingGroups&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;v1-lightbulbs&quot;</span><span class="punctuation">,</span> <span class="string">&quot;WA&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;BillingGroup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LightBulbBillingGroup&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;OverrideSettings&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;AttributePayload&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;MERGE&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;ThingTypeName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;REPLACE&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;ThingGroups&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;DO_NOTHING&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;certificate&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;AWS::IoT::Certificate&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Properties&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CertificateId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;Ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWS::IoT::Certificate::Id&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Status&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Active&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;policy&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;AWS::IoT::Policy&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Properties&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;PolicyDocument&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;iot:Publish&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;arn:aws:iot:us-east-1:123456789012:topic/foo/bar&quot;</span><span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DeviceConfiguration&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;FallbackUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.example.com/test-site&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;LocationUrl&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Fn::FindInMap&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;LocationTable&quot;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DeviceLocation&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="string">&quot;LocationUrl&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>The pre-provisioning hook is a Lambda function that validates the parameters passed from the device before provisioning. This Lambda function must exist in your account to provision devices.</p>
<p>This part is set up to perform actions before configuring devices. For example, check devices against a known device database to prevent unauthorized devices from connecting to your account.</p>
<p><img src="https://i.imgur.com/pL1yTCM.png" alt="Imgur"></p>
<ul>
<li>Choose <strong>Create a Lambda function</strong></li>
</ul>
<h3 id="Sample-provisioning-hook-where-you-validate-the-request-before-activating-a-certificate"><a href="#Sample-provisioning-hook-where-you-validate-the-request-before-activating-a-certificate" class="headerlink" title="Sample provisioning hook where you validate the request before activating a certificate"></a>Sample provisioning hook where you validate the request before activating a certificate</h3><blockquote>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/aws-samples/aws-iot-fleet-provisioning#sample-provisioning-hook-where-you-validate-the-request-before-activating-a-certificate">https://github.com/aws-samples/aws-iot-fleet-provisioning#sample-provisioning-hook-where-you-validate-the-request-before-activating-a-certificate</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"></span><br><span class="line">provision_response = &#123;</span><br><span class="line">    <span class="string">&#x27;allowProvisioning&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&quot;parameterOverrides&quot;</span>: &#123;<span class="string">&quot;CertDate&quot;</span>: date.today().strftime(<span class="string">&quot;%m/%d/%y&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">event, context</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment">########################</span></span><br><span class="line">    <span class="comment">## Stringent validation against internal API&#x27;s/DB etc to validate the request before proceeding</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment">## if event[&#x27;parameters&#x27;][&#x27;SerialNumber&#x27;] = &quot;approved by company CSO&quot;:</span></span><br><span class="line">    <span class="comment">##     provision_response[&quot;allowProvisioning&quot;] = True</span></span><br><span class="line">    <span class="comment">#####################</span></span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> provision_response</span><br></pre></td></tr></table></figure>

<h3 id="Hook-Input"><a href="#Hook-Input" class="headerlink" title="Hook Input"></a>Hook Input</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/pre-provisioning-hook.html#pre-provisioning-hook-input">https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/pre-provisioning-hook.html#pre-provisioning-hook-input</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;claimCertificateId&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;certificateId&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;certificatePem&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;templateArn&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;arn:aws:iot:us-east-1:XXXXXXXXXXXX:provisioningtemplate/MyTemplate&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clientId&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;221a6d10-9c7f-42f1-9153-e52e6fc869c1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;parameters&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;string&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>When registering a device with AWS IoT, this object is sent to the Lambda function by AWS IoT.</p>
<p>The <code>parameters</code> object passed to the Lambda function contains attributes from the parameters argument passed in the <strong>RegisterThing</strong> request payload.</p>
<h2 id="Configuration-Device-Side"><a href="#Configuration-Device-Side" class="headerlink" title="Configuration - Device Side"></a>Configuration - Device Side</h2><p>The downloaded Claim certificate and private key need to be moved to the device.</p>
<p>You can use commands like <code>scp</code> to copy files from your local machine to your device via SSH.</p>
<p>Additionally, you will need to install the desired <strong>IoT Device SDK</strong> on the device.</p>
<blockquote>
<p>AWS IoT Device SDKs, Mobile SDKs, and AWS IoT Device Client -  - <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/iot-sdks.html">https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/iot-sdks.html</a></p>
</blockquote>
<p>Currently, Device SDK supports writing code in C++, javascript, Java, Python, Embedded-C languages, depending on your requirements and scenarios.</p>
<h3 id="Using-AWS-IoT-Device-SDK"><a href="#Using-AWS-IoT-Device-SDK" class="headerlink" title="Using AWS IoT Device SDK"></a>Using AWS IoT Device SDK</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/aws/aws-iot-device-sdk-python-v2">https://github.com/aws/aws-iot-device-sdk-python-v2</a></p>
</blockquote>
<p>This article mainly uses the <strong>Python IoT Device SDKv2</strong>.</p>
<p>To install the SDK on the device, first ensure that the device has <code>git</code>, <code>Python3</code>, and <code>Python3-pip</code> packages.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/aws/aws-iot-device-sdk-python-v2.git</span><br></pre></td></tr></table></figure>

<p>Initialize the package</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#  (Optional) Setup the version number of your local build. The default version </span><br><span class="line">#    for awsiotsdk is set to &quot;1.0.0-dev&quot;, you can set the version number of the</span><br><span class="line">#    local build in &quot;aws-iot-device-sdk-python-v2/awsiot/__init__.py&quot;</span><br><span class="line">sed -i &quot;s/__version__ = &#x27;1.0.0-dev&#x27;/__version__ = &#x27;&lt;SDK_VERSION&gt;&#x27;/&quot; \</span><br><span class="line">  aws-iot-device-sdk-python-v2/awsiot/__init__.py</span><br><span class="line"></span><br><span class="line">#  Install using Pip (use &#x27;python&#x27; instead of &#x27;python3&#x27; on Windows)</span><br><span class="line">python3 -m pip install ./aws-iot-device-sdk-python-v2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>In <code>aws-iot-device-sdk-python-v2/samples/fleetprovisioning.py</code> , you can set up the Provisioning Template.</p>
<p>Afterwards, you need to specify on your device:</p>
<p>AWS IoT Endpoint<br>Claim Certificate<br>Private Key<br>to connect to AWS IoT Core.<br>You can find the script’s operating steps here:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/aws/aws-iot-device-sdk-python-v2/blob/main/samples/fleetprovisioning.md">https://github.com/aws/aws-iot-device-sdk-python-v2/blob/main/samples/fleetprovisioning.md</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 fleetprovisioning.py --endpoint &lt;endpoint&gt; --cert &lt;file&gt; --key &lt;file&gt; --template_name &lt;name&gt; --template_parameters &#x27;&#123;\&quot;SerialNumber\&quot;:\&quot;1\&quot;,\&quot;DeviceLocation\&quot;:\&quot;Seattle\&quot;&#125;&#x27; --csr &lt;path to csr file&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Reference-Documents"><a href="#Reference-Documents" class="headerlink" title="Reference Documents"></a>Reference Documents</h2><p>[+] <a target="_blank" rel="noopener" href="https://github.com/aws-samples/aws-iot-fleet-provisioning">https://github.com/aws-samples/aws-iot-fleet-provisioning</a><br>[+] <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/iot-provision.html">https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/iot-provision.html</a><br>[+] <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/provision-wo-cert.html#claim-based">https://docs.aws.amazon.com/zh_tw/iot/latest/developerguide/provision-wo-cert.html#claim-based</a><br>[+] <a target="_blank" rel="noopener" href="https://aws.amazon.com/tw/blogs/iot/how-to-automate-onboarding-of-iot-devices-to-aws-iot-core-at-scale-with-fleet-provisioning/">https://aws.amazon.com/tw/blogs/iot/how-to-automate-onboarding-of-iot-devices-to-aws-iot-core-at-scale-with-fleet-provisioning/</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://leozzmc.github.io/en">Kevin Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://leozzmc.github.io/en/posts/889a40ef.html">https://leozzmc.github.io/en/posts/889a40ef.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/en/tags/AWS/">AWS</a><a class="post-meta__tags" href="/en/tags/IoT-Core/">IoT Core</a><a class="post-meta__tags" href="/en/tags/Device-Provisioning/">Device Provisioning</a><a class="post-meta__tags" href="/en/tags/Certificate/">Certificate</a><a class="post-meta__tags" href="/en/tags/Policy/">Policy</a></div><div class="post-share"><div class="social-share" data-image="/en/img/OIG.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/en/posts/aws-iot-device-shadow.html" title="Hands-On Practice: AWS IoT Device Shadow"><img class="cover" src="/en/img/pepe_shadow.jpg" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Hands-On Practice: AWS IoT Device Shadow</div></div><div class="info-2"><div class="info-item-1">Intro - What is AWS IoT Device Shadow?In real world, sometime it is difficult to get the actual device state in real time in such IoT scenarios. A device shadow can overcome this challenge, Device Shadow can consider a virtual  virtual representation of a device which managed by the IoT Things resource created in AWS IoT Core.  The Shadow document is a JSON or a JavaScript notation doc that is ...</div></div></div></a><a class="pagination-related" href="/en/posts/8d39dbf8.html" title="FreeRTOS_Note"><img class="cover" src="/en/img/freertos/pepe.jpg" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">FreeRTOS_Note</div></div><div class="info-2"><div class="info-item-1">AWS FreeRTOS FreeRTOS includes libraries for connectivity, security, and over-the-air (OTA) updates. FreeRTOS also includes demo applications that show FreeRTOS features on qualified boards.   FreeRTOS is an open-source project. You can download the source code, contribute changes or enhancements, or report issues on the GitHub site at https://github.com/FreeRTOS/FreeRTOS.  FreeRTOS - Architect...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/en/img/me.jpg" onerror="this.onerror=null;this.src='/en/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Kevin Liu</div><div class="author-info-description">👍👍👍👍👍</div><div class="site-data"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/leozzmc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/leozzmc" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:zzmczzmczzmc870125@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #e0ad5a;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/kevin-liu087" target="_blank" title="LinkedIn"><i class="fa-brands fa-linkedin" style="color: #0373fc;"></i></a><a class="social-icon" href="https://www.youtube.com/channel/UC2AU_vpxPu0oKcgZl3UJSNg" target="_blank" title="Youtube"><i class="fa-brands fa-youtube" style="color: #dc1e1e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">🛫🛬</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-Fleet-Provisioning"><span class="toc-number">1.1.</span> <span class="toc-text">What is Fleet Provisioning?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Provisioning-by-Claim"><span class="toc-number">1.1.1.</span> <span class="toc-text">Provisioning by Claim</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provisioning-by-Trusted-User"><span class="toc-number">1.1.2.</span> <span class="toc-text">Provisioning by Trusted User</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Provisioning-by-Claim-Process"><span class="toc-number">1.2.</span> <span class="toc-text">Provisioning by Claim Process</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration-AWS-IoT-Core"><span class="toc-number">1.3.</span> <span class="toc-text">Configuration - AWS IoT Core</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-Certificates-and-Public-x2F-Private-Key-Pairs"><span class="toc-number">1.3.1.</span> <span class="toc-text">Create Certificates and Public&#x2F;Private Key Pairs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-Provisioning-Template-and-Attach-Policy"><span class="toc-number">1.3.2.</span> <span class="toc-text">Create Provisioning Template and Attach Policy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configure-Pre-provisioning"><span class="toc-number">1.3.3.</span> <span class="toc-text">Configure Pre-provisioning</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sample-provisioning-hook-where-you-validate-the-request-before-activating-a-certificate"><span class="toc-number">1.3.4.</span> <span class="toc-text">Sample provisioning hook where you validate the request before activating a certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook-Input"><span class="toc-number">1.3.5.</span> <span class="toc-text">Hook Input</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration-Device-Side"><span class="toc-number">1.4.</span> <span class="toc-text">Configuration - Device Side</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-AWS-IoT-Device-SDK"><span class="toc-number">1.4.1.</span> <span class="toc-text">Using AWS IoT Device SDK</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference-Documents"><span class="toc-number">1.5.</span> <span class="toc-text">Reference Documents</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/en/posts/aws_iot_jobs.html" title="Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial"><img src="/en/img/aws_iot_job.png" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial"/></a><div class="content"><a class="title" href="/en/posts/aws_iot_jobs.html" title="Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial">Executing Remote Operations with AWS IoT Jobs: A Hands-On Tutorial</a><time datetime="2024-01-20T07:04:16.000Z" title="Created 2024-01-20 15:04:16">2024-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/752506ab.html" title="Linux Process Deep Dive-1: Knowledge of PID 0 "><img src="/en/img/PID0.jpeg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Linux Process Deep Dive-1: Knowledge of PID 0 "/></a><div class="content"><a class="title" href="/en/posts/752506ab.html" title="Linux Process Deep Dive-1: Knowledge of PID 0 ">Linux Process Deep Dive-1: Knowledge of PID 0 </a><time datetime="2023-12-13T23:01:50.000Z" title="Created 2023-12-14 07:01:50">2023-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/8d39dbf8.html" title="FreeRTOS_Note"><img src="/en/img/freertos/pepe.jpg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="FreeRTOS_Note"/></a><div class="content"><a class="title" href="/en/posts/8d39dbf8.html" title="FreeRTOS_Note">FreeRTOS_Note</a><time datetime="2023-12-02T07:50:49.000Z" title="Created 2023-12-02 15:50:49">2023-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/889a40ef.html" title="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance"><img src="/en/img/OIG.jpeg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance"/></a><div class="content"><a class="title" href="/en/posts/889a40ef.html" title="Fleet Provisioning - Provisioning Devices to AWS IoT in Advance">Fleet Provisioning - Provisioning Devices to AWS IoT in Advance</a><time datetime="2023-11-09T07:14:35.000Z" title="Created 2023-11-09 15:14:35">2023-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/posts/aws-iot-device-shadow.html" title="Hands-On Practice: AWS IoT Device Shadow"><img src="/en/img/pepe_shadow.jpg" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Hands-On Practice: AWS IoT Device Shadow"/></a><div class="content"><a class="title" href="/en/posts/aws-iot-device-shadow.html" title="Hands-On Practice: AWS IoT Device Shadow">Hands-On Practice: AWS IoT Device Shadow</a><time datetime="2023-11-08T08:30:18.000Z" title="Created 2023-11-08 16:30:18">2023-11-08</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2025 By Kevin Liu</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/en/js/utils.js"></script><script src="/en/js/main.js"></script><script src="/en/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'dark'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null
  const getUtterancesTheme = theme => theme === 'dark' ? 'photon-dark' : 'github-light'

  const loadUtterances = (el = document, key) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyUtterances = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const config = {
      src: 'https://utteranc.es/client.js',
      repo: 'leozzmc/Blog_Reply',
      theme: getUtterancesTheme(document.documentElement.getAttribute('data-theme')),
      crossorigin: 'anonymous',
      async: true,
      ...option,
      'issue-term': isShuoshuo ? key : (option && option['issue-term']) || 'pathname'
    }

    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => ele.setAttribute(key, value))
    el.querySelector('#utterances-wrap').appendChild(ele)
  }

  const changeUtterancesTheme = theme => {
    const iframe = document.querySelector('#utterances-wrap iframe')
    if (iframe) {
      const message = {
        type: 'set-theme',
        theme: getUtterancesTheme(theme)
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es')
    }
  }

  btf.addGlobalFn('themeChange', changeUtterancesTheme, 'utterances')

  if (isShuoshuo) {
    'Utterances' === 'Utterances'
      ? window.shuoshuoComment = { loadComment: loadUtterances }
      : window.loadOtherComment = loadUtterances
    return
  }
  
  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><script data-pjax src="/en/self/btf.js"></script><script data-pjax src="/en/self/tw_en.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script data-pjax src="/self/calendar.js"></script><script data-pjax src="/self/languages.js"></script><script id="canvas_nest" defer="defer" color="34,34,34" opacity="0.8" zIndex="-1" count="350" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>